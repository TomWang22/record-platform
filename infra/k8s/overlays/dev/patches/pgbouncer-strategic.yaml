apiVersion: apps/v1
kind: Deployment
metadata:
  name: pgbouncer
  namespace: record-platform
spec:
  template:
    spec:
      containers:
      - name: pgbouncer
        # if you want the local image you built:
        image: pgbouncer:dev
        args: ["pgbouncer","/etc/pgbouncer/pgbouncer.ini"]
        securityContext:
          runAsUser: 1000         # your Dockerfile created user 1000
          runAsGroup: 1000
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
        volumeMounts:
        # keep existing mounts; add a writable /tmp for the unix socket
        - name: pgb-tmp
          mountPath: /tmp
      volumes:
      - name: pgb-tmp
        emptyDir: {}