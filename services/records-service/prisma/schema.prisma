datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // help Prisma know we use multiple schemas
  schemas  = ["records", "public", "auth"]
}

generator client {
  provider      = "prisma-client-js"
  output        = "../generated/records-client"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-arm64-openssl-3.0.x"]
}

model Record {
  @@schema("records")
  @@map("records")

  id                 String   @id @db.Uuid @default(uuid())
  userId             String   @db.Uuid @map("user_id")

  artist             String   @db.VarChar(256)
  name               String   @db.VarChar(256)
  format             String   @db.VarChar(64)

  recordGrade        String?  @db.VarChar(16) @map("record_grade")
  sleeveGrade        String?  @db.VarChar(16) @map("sleeve_grade")

  hasInsert          Boolean  @map("has_insert")          @default(false)
  insertGrade        String?  @db.VarChar(16)             @map("insert_grade")

  hasBooklet         Boolean  @map("has_booklet")         @default(false)
  bookletGrade       String?  @db.VarChar(16)             @map("booklet_grade")

  hasObiStrip        Boolean  @map("has_obi_strip")       @default(false)
  obiStripGrade      String?  @db.VarChar(16)             @map("obi_strip_grade")

  hasFactorySleeve   Boolean  @map("has_factory_sleeve")  @default(false)
  factorySleeveGrade String?  @db.VarChar(16)             @map("factory_sleeve_grade")

  isPromo            Boolean  @map("is_promo")            @default(false)

  catalogNumber      String?  @db.VarChar(64)             @map("catalog_number")
  notes              String?  @db.Text

  purchasedAt        DateTime?                            @map("purchased_at")
  pricePaid          Decimal?  @db.Decimal(10, 2)         @map("price_paid")

  releaseYear        Int?      @map("release_year")
  releaseDate        DateTime? @map("release_date")
  pressingYear       Int?      @map("pressing_year")
  label              String?   @db.VarChar(128)
  labelCode          String?   @db.VarChar(64)            @map("label_code")

  mediaPieces        RecordMedium[]

  createdAt          DateTime @default(now())             @map("created_at")
  updatedAt          DateTime @updatedAt                  @map("updated_at")

  @@index([userId])
  @@index([artist])
  @@index([catalogNumber])
  @@index([artist, name, format])
  @@index([releaseYear])
  @@index([label])
}

model RecordMedium {
  @@schema("records")
  @@map("record_media")

  id         String   @id @db.Uuid @default(uuid())
  recordId   String   @db.Uuid @map("record_id")
  record     Record   @relation(fields: [recordId], references: [id], onDelete: Cascade)

  index      Int
  kind       String   @db.Text
  sizeInch   Int?     @map("size_inch")
  speedRpm   Int?     @map("speed_rpm")

  discGrade  String?  @db.VarChar(16) @map("disc_grade")
  sides      Json?
  notes      String?  @db.Text

  createdAt  DateTime @default(now())  @map("created_at")
  updatedAt  DateTime @updatedAt       @map("updated_at")

  @@unique([recordId, index])
}

model Users {
  @@schema("auth")
  @@map("users")
  @@ignore
  id String @id @db.Uuid
}

model RecordsStaging {
  @@schema("records")
  @@map("records_staging")
  @@ignore
  id String @id @db.Uuid
}

model SearchTerms {
  @@schema("public")
  @@map("search_terms")
  @@ignore
  id String @id @db.Uuid
}